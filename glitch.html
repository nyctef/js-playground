<html>
    <head></head>
    <body>
        <div style="display: flex; flex-direction: column; align-items:center">
            <div id=drift>
                drift text
            </div>
        </div>
    </body>
    <script>

function requestAnimationFrames(callback) {

    var cancelRequestId;
    
    function nextFrame(callback) {
        window.requestAnimationFrame(timestamp => {
            callback(timestamp)
            cancelRequestId = requestAnimationFrames
            nextFrame(callback)
        })
    }

    nextFrame(callback)

    return function cancelRequest() {
        window.cancelAnimationFrame(canceRequestId)
    }
}

function baseline() {
    var start = performance.now()
    return function baseline(ms, next) {
        return next(performance.now() - start)
    }
}


function resetAfter(resetMs) {
    return function resetAfter(ms, next) {
        return next(ms % 1000)
    }
}

function scale(factor) {
    return function scale(ms, next) {
        return next(ms * factor)
    }
}

function calcAnimation(ms, next) {
    ms = ms + 1
    return next(ms)
}

function setLeft(ms, next) {
    return {
        ...next(ms),
        left: ms
    }
}

var animations = [
    baseline(),
    resetAfter(1000),
    scale(1/50),
    setLeft,
    ];

function getNextInPipeline(animation, pipeline) {
   return function(ms) { return animation(ms, pipeline) }
}

function buildPipeline(animations) {
    var pipeline = (ms) => ({})
    var i = animations.length - 1
    while (i >= 0) {
        pipeline = getNextInPipeline(animations[i], pipeline)
        i--
    }
    return pipeline
}

var pipeline = buildPipeline(animations)

var drift = document.getElementById('drift');
drift.style.position = 'relative'
drift.style.left = 20;

requestAnimationFrames(ms => {
    drift.style.left = pipeline(ms).left;
    //drift.style.left = (ms % 1000) / 50
    //drift.style.top = (ms % 1000) / 500
})

    </script>
</html>
